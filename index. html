<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Comparador de Produtos Online</title>
<meta name="description" content="Compare preços, qualidade, entrega e confiabilidade de produtos da internet. Encontre a melhor oferta para qualquer produto online.">
<meta name="keywords" content="comparador, preços, entrega, qualidade, confiabilidade, melhor oferta, produtos online">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="favicon.ico" type="image/x-icon">

<style>
body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
h1, h2 { text-align: center; }
.container { max-width: 1100px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
input, button, select { padding: 8px; margin: 4px; }
button { cursor: pointer; }
table { width: 100%; border-collapse: collapse; margin-top: 15px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
.rank { font-weight: bold; }
.melhor { background: #4caf50 !important; color: white; }
.preco { background: #c8e6c9; }
.entrega { background: #fff9c4; }
.confianca { background: #b3e5fc; }
.qualidade { background: #f8bbd0; }
input[type="text"], input[type="number"] { width: 120px; }
@media(max-width:800px){input{width:100px;}}
</style>
</head>
<body>

<div class="container">
<h1>Comparador de Produtos</h1>

<h2>Cadastrar Oferta</h2>
<input id="nome" placeholder="Produto">
<input id="loja" placeholder="Loja">
<input id="link" placeholder="Link da oferta">
<input id="preco" type="number" placeholder="Preço">
<input id="frete" type="number" placeholder="Frete">
<input id="prazo" type="number" placeholder="Entrega (dias)">
<input id="confianca" type="number" placeholder="Confiabilidade (0-10)">
<input id="qualidade" type="number" placeholder="Qualidade (0-10)">
<button onclick="addProduto()">Adicionar</button>

<h2>Ajuste de Pesos (0 a 1)</h2>
Preço: <input type="number" id="pesoPreco" min="0" max="1" step="0.1" value="0.3">
Entrega: <input type="number" id="pesoEntrega" min="0" max="1" step="0.1" value="0.2">
Confiabilidade: <input type="number" id="pesoConfianca" min="0" max="1" step="0.1" value="0.25">
Qualidade: <input type="number" id="pesoQualidade" min="0" max="1" step="0.1" value="0.25">
<button onclick="render()">Atualizar Pesos</button>

<h2>Filtros Rápidos</h2>
Produto: <input type="text" id="filtroProduto" oninput="render()">
Loja: <input type="text" id="filtroLoja" oninput="render()">

<h2>Comparação</h2>
<button onclick="comprarMelhor()">Comprar Melhor Oferta</button>
<button onclick="exportarCSV()">Exportar CSV</button>

<table>
<thead>
<tr>
<th>Produto</th>
<th>Loja</th>
<th>Preço Final</th>
<th>Entrega</th>
<th>Confiável</th>
<th>Qualidade</th>
<th>Custo-benefício</th>
<th>Link</th>
</tr>
</thead>
<tbody id="tabela"></tbody>
</table>
</div>

<script>
let produtos = JSON.parse(localStorage.getItem("produtos")) || [];

function salvarLocal() {
  localStorage.setItem("produtos", JSON.stringify(produtos));
}

function addProduto() {
  const nomeVal = nome.value.trim();
  const lojaVal = loja.value.trim();
  const linkVal = link.value.trim();
  const precoVal = Number(preco.value);
  const freteVal = Number(frete.value);
  const prazoVal = Number(prazo.value);
  const confiancaVal = Number(confianca.value);
  const qualidadeVal = Number(qualidade.value);

  if(!nomeVal || !lojaVal || !linkVal || precoVal < 0 || freteVal < 0 || prazoVal < 0){
    alert("Preencha todos os campos corretamente!");
    return;
  }

  const p = {
    nome:nomeVal, loja:lojaVal, link:linkVal,
    precoFinal: precoVal + freteVal,
    prazo: prazoVal,
    confianca: confiancaVal,
    qualidade: qualidadeVal,
    historico: [{preco: precoVal, frete: freteVal, prazo: prazoVal, confianca: confiancaVal, qualidade: qualidadeVal, data: new Date().toLocaleString()}]
  };

  produtos.push(p);
  salvarLocal();
  render();
}

function render() {
  const tbody = document.getElementById("tabela");
  tbody.innerHTML="";

  const pesoPreco = Number(document.getElementById("pesoPreco").value);
  const pesoEntrega = Number(document.getElementById("pesoEntrega").value);
  const pesoConfianca = Number(document.getElementById("pesoConfianca").value);
  const pesoQualidade = Number(document.getElementById("pesoQualidade").value);

  const maxPreco = Math.max(...produtos.map(x=>x.precoFinal)||[1]);
  const maxPrazo = Math.max(...produtos.map(x=>x.prazo)||[1]);
  const maxConfianca = Math.max(...produtos.map(x=>x.confianca)||[1]);
  const maxQualidade = Math.max(...produtos.map(x=>x.qualidade)||[1]);

  const filtroProduto = document.getElementById("filtroProduto").value.toLowerCase();
  const filtroLoja = document.getElementById("filtroLoja").value.toLowerCase();

  produtos.forEach(p=>{
    p.normalPreco = 1-(p.precoFinal/maxPreco);
    p.normalPrazo = 1-(p.prazo/maxPrazo);
    p.normalConfianca = p.confianca/maxConfianca;
    p.normalQualidade = p.qualidade/maxQualidade;
    p.notaGeral = p.normalPreco*pesoPreco + p.normalPrazo*pesoEntrega +
                   p.normalConfianca*pesoConfianca + p.normalQualidade*pesoQualidade;
  });

  const melhorGeral = Math.max(...produtos.map(p=>p.notaGeral)||[0]);
  const melhorPreco = Math.min(...produtos.map(p=>p.precoFinal)||[0]);
  const melhorEntrega = Math.min(...produtos.map(p=>p.prazo)||[0]);
  const melhorConfianca = Math.max(...produtos.map(p=>p.confianca)||[0]);
  const melhorQualidade = Math.max(...produtos.map(p=>p.qualidade)||[0]);

  produtos.forEach(p=>{
    if(filtroProduto && !p.nome.toLowerCase().includes(filtroProduto)) return;
    if(filtroLoja && !p.loja.toLowerCase().includes(filtroLoja)) return;

    const tr = document.createElement("tr");
    tr.className="";
    if(p.notaGeral === melhorGeral) tr.classList.add("melhor");
    else if(p.precoFinal === melhorPreco) tr.classList.add("preco");
    else if(p.prazo === melhorEntrega) tr.classList.add("entrega");
    else if(p.confianca === melhorConfianca) tr.classList.add("confianca");
    else if(p.qualidade === melhorQualidade) tr.classList.add("qualidade");

    tr.innerHTML=`
      <td>${p.nome}</td>
      <td>${p.loja}</td>
      <td>R$ ${p.precoFinal.toFixed(2)}</td>
      <td>${p.prazo} dias</td>
      <td>${p.confianca}</td>
      <td>${p.qualidade}</td>
      <td>${p.notaGeral.toFixed(4)}</td>
      <td><a href="${p.link}" target="_blank">Ir para loja</a></td>
    `;
    tbody.appendChild(tr);
  });
}

function comprarMelhor(){
  const melhor = produtos.reduce((a,b)=>a.notaGeral>b.notaGeral?a:b,null);
  if(melhor) window.open(melhor.link,"_blank");
  else alert("Nenhum produto cadastrado ainda!");
}

function exportarCSV(){
  if(produtos.length===0){alert("Nenhum produto para exportar!"); return;}
  let csv="Produto,Loja,Preço Final,Entrega,Confiabilidade,Qualidade,Custo-benefício,Link\n";
  produtos.forEach(p=>{
    csv+=`${p.nome},${p.loja},${p.precoFinal},${p.prazo},${p.confianca},${p.qualidade},${p.notaGeral.toFixed(4)},${p.link}\n`;
  });
  const blob = new Blob([csv], {type: "text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "ofertas.csv";
  a.click();
  URL.revokeObjectURL(url);
}

render();
</script>

</body>
</html>